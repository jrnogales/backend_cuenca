<% layout('partials/layout') %>

<%
  // Seguro ante nulos/indefinidos
  const _paquete = paquete || {};
  const _titulo  = _paquete.titulo || 'Paquete';
  const _fecha   = String(fecha || '');
  const _ad      = Number(adultos || 0);
  const _ni      = Number(ninos   || 0);
  const _total   = Number(total   || 0);
  const _codigo  = String(codigo  || '');
  const esLote   = _codigo.startsWith('LOTE-'); // <- comprobante de carrito
%>

<div class="card" style="max-width:640px;margin:auto;text-align:center">
  <h2>🎉 Reserva confirmada</h2>

  <p><b>Paquete:</b> <%= _titulo %></p>
  <p><b>Fecha del viaje:</b> <%= _fecha %></p>
  <p><b>Pasajeros:</b> Adultos <%= _ad %> · Niños <%= _ni %></p>
  <p><b>Total:</b> $<%= _total.toFixed(2) %></p>
  <p><b>Código de reserva:</b> <span style="color:#1b7af3"><%= _codigo %></span></p>

  <div style="margin-top:24px;display:flex;justify-content:center;gap:12px;flex-wrap:wrap">
    <a href="/" class="btn">← Volver al inicio</a>

    <% if (!esLote) { %>
      <!-- Para RES-XXXX: permite cancelar aquí -->
      <form method="POST" action="/checkout/cancelar/<%= _codigo %>" onsubmit="return confirmCancel()">
        <button class="btn btn-danger" type="submit">Cancelar reserva</button>
      </form>
    <% } else { %>
      <!-- Para LOTE-XXXX: explicar que son múltiples reservas -->
      <div class="notice" style="text-align:left;max-width:520px">
        Esta compra corresponde a <b>múltiples reservas</b> con códigos <code>RES-…</code>.
        Si necesitas cancelar, ve a <a href="/mis-reservas">Mis reservas</a> y cancela
        cada una de forma individual (se repondrán los cupos del día correspondiente).
      </div>
    <% } %>
  </div>
</div>

<script>
  function confirmCancel() {
    return confirm("¿Seguro que deseas cancelar esta reserva?\nSe liberarán los cupos correspondientes.");
  }
</script>
