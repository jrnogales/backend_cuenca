<% layout('partials/layout') %>

<style>
  .auth-wrapper{
    min-height: calc(100vh - 80px);
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .auth-card{
    width:100%;
    max-width:520px;
    background:#fff;
    border-radius:18px;
    padding:32px 32px 28px;
    box-shadow:0 18px 45px rgba(15,23,42,.18);
    border:1px solid #e5e7eb;
  }
  .auth-title{
    text-align:center;
    font-size:20px;
    font-weight:600;
    margin-bottom:24px;
    color:#111827;
  }
  .field-group{
    display:flex;
    flex-direction:column;
    gap:4px;
    margin-bottom:14px;
  }
  .field-label{
    font-size:14px;
    font-weight:500;
    color:#374151;
  }
  .field-input{
    border-radius:999px;
    border:1px solid #e5e7eb;
    padding:10px 14px;
    font-size:14px;
    outline:none;
    transition:border-color .15s, box-shadow .15s;
  }
  .field-input:focus{
    border-color:#2563eb;
    box-shadow:0 0 0 1px rgba(37,99,235,.35);
  }
  .field-input.input-error{
    border-color:#ef4444;
    box-shadow:0 0 0 1px rgba(239,68,68,.25);
  }
  .field-error{
    font-size:12px;
    color:#ef4444;
    min-height:16px;
  }
  .btn-block{
    width:100%;
    border:none;
    border-radius:999px;
    padding:12px 16px;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    background:#2563eb;
    color:#fff;
  }
  .btn-block:hover{ background:#1d4ed8; }
  .auth-footer{
    margin-top:10px;
    font-size:13px;
    text-align:center;
    color:#6b7280;
  }
  .auth-footer a{
    color:#2563eb;
    text-decoration:none;
    font-weight:500;
  }
</style>

<div class="auth-wrapper">
  <div class="auth-card">
    <h2 class="auth-title">Completa tus datos para continuar.</h2>

    <form id="registerForm" method="POST" action="/register">
      <!-- Nombre -->
      <div class="field-group">
        <label class="field-label" for="nombre">Nombre</label>
        <input
          id="nombre"
          name="nombre"
          type="text"
          class="field-input"
          autocomplete="given-name"
        >
        <div id="nombreError" class="field-error"></div>
      </div>

      <!-- Apellido -->
      <div class="field-group">
        <label class="field-label" for="apellido">Apellido</label>
        <input
          id="apellido"
          name="apellido"
          type="text"
          class="field-input"
          autocomplete="family-name"
        >
        <div id="apellidoError" class="field-error"></div>
      </div>

      <!-- Cédula -->
      <div class="field-group">
        <label class="field-label" for="cedula">Cédula</label>
        <input
          id="cedula"
          name="cedula"
          type="text"
          class="field-input"
          inputmode="numeric"
          maxlength="10"
        >
        <div id="cedulaError" class="field-error"></div>
      </div>

      <!-- Email -->
      <div class="field-group">
        <label class="field-label" for="email">Email</label>
        <input
          id="email"
          name="email"
          type="email"
          class="field-input"
          autocomplete="email"
        >
        <div id="emailError" class="field-error"></div>
      </div>

      <!-- Teléfono -->
      <div class="field-group">
        <label class="field-label" for="telefono">Teléfono</label>
        <input
          id="telefono"
          name="telefono"
          type="text"
          class="field-input"
          inputmode="numeric"
          maxlength="10"
        >
        <div id="telefonoError" class="field-error"></div>
      </div>

      <!-- Contraseña -->
      <div class="field-group">
        <label class="field-label" for="password">Contraseña</label>
        <input
          id="password"
          name="password"
          type="password"
          class="field-input"
          autocomplete="new-password"
        >
        <div id="passwordError" class="field-error"></div>
      </div>

      <button type="submit" class="btn-block">Registrar</button>
    </form>

    <div class="auth-footer">
      ¿Ya tienes cuenta? <a href="/login">Inicia sesión aquí</a>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('registerForm');

  const nombre   = document.getElementById('nombre');
  const apellido = document.getElementById('apellido');
  const cedula   = document.getElementById('cedula');
  const email    = document.getElementById('email');
  const telefono = document.getElementById('telefono');
  const password = document.getElementById('password');

  const nombreError   = document.getElementById('nombreError');
  const apellidoError = document.getElementById('apellidoError');
  const cedulaError   = document.getElementById('cedulaError');
  const emailError    = document.getElementById('emailError');
  const telefonoError = document.getElementById('telefonoError');
  const passwordError = document.getElementById('passwordError');

  function setError(input, errorEl, msg) {
    if (msg) {
      errorEl.textContent = msg;
      input.classList.add('input-error');
    } else {
      errorEl.textContent = '';
      input.classList.remove('input-error');
    }
  }

  function validateNombre() {
    const v = nombre.value.trim();
    if (!v) {
      setError(nombre, nombreError, 'Ingresa tu nombre.');
      return false;
    }
    setError(nombre, nombreError, '');
    return true;
  }

  function validateApellido() {
    const v = apellido.value.trim();
    if (!v) {
      setError(apellido, apellidoError, 'Ingresa tu apellido.');
      return false;
    }
    setError(apellido, apellidoError, '');
    return true;
  }

  function validateCedula() {
    const v = cedula.value.trim();
    if (!/^\d{10}$/.test(v)) {
      setError(cedula, cedulaError, 'La cédula debe tener 10 dígitos numéricos.');
      return false;
    }
    setError(cedula, cedulaError, '');
    return true;
  }

  function validateEmail() {
    const v = email.value.trim();
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!regex.test(v)) {
      setError(email, emailError, 'Ingresa un correo válido (ej. jordi@gmail.com).');
      return false;
    }
    setError(email, emailError, '');
    return true;
  }

  function validateTelefono() {
    const v = telefono.value.trim();
    if (!/^\d{10}$/.test(v)) {
      setError(telefono, telefonoError, 'El teléfono debe tener 10 dígitos numéricos.');
      return false;
    }
    setError(telefono, telefonoError, '');
    return true;
  }

  function validatePassword() {
    const v = password.value;
    if (v.length < 6) {
      setError(password, passwordError, 'La contraseña debe tener al menos 6 caracteres.');
      return false;
    }
    setError(password, passwordError, '');
    return true;
  }

  // Validación en tiempo real
  nombre.addEventListener('input', validateNombre);
  apellido.addEventListener('input', validateApellido);
  cedula.addEventListener('input', validateCedula);
  email.addEventListener('input', validateEmail);
  telefono.addEventListener('input', validateTelefono);
  password.addEventListener('input', validatePassword);

  form.addEventListener('submit', (e) => {
    const okNombre   = validateNombre();
    const okApellido = validateApellido();
    const okCedula   = validateCedula();
    const okEmail    = validateEmail();
    const okTel      = validateTelefono();
    const okPass     = validatePassword();

    if (!(okNombre && okApellido && okCedula && okEmail && okTel && okPass)) {
      e.preventDefault();
      // foco en el primer campo con error
      const firstError = document.querySelector('.input-error');
      if (firstError) firstError.focus();
    }
  });
</script>
