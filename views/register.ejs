<% layout('partials/layout') %>

<h2 style="text-align:center; margin-bottom:16px;">
  Completa tus datos para registrarte.
</h2>

<form id="register-form" method="POST" action="/register" novalidate
      style="max-width:600px; margin:0 auto; display:flex; flex-direction:column; gap:16px;">

  <!-- Nombre -->
  <div class="field-group">
    <label for="nombre">Nombre</label>
    <input id="nombre" name="nombre" type="text" required minlength="1" autocomplete="given-name">
    <span class="error" id="err_nombre"></span>
  </div>

  <!-- Apellido -->
  <div class="field-group">
    <label for="apellido">Apellido</label>
    <input id="apellido" name="apellido" type="text" required minlength="1" autocomplete="family-name">
    <span class="error" id="err_apellido"></span>
  </div>

  <!-- Cédula -->
  <div class="field-group">
    <label for="cedula">Cédula</label>
    <input id="cedula" name="cedula"
           type="text"
           inputmode="numeric"
           maxlength="10"
           minlength="10"
           required>
    <span class="error" id="err_cedula"></span>
  </div>

  <!-- Email -->
  <div class="field-group">
    <label for="email">Email</label>
    <input id="email" name="email"
           type="email"
           required
           autocomplete="email">
    <span class="error" id="err_email"></span>
  </div>

  <!-- Teléfono -->
  <div class="field-group">
    <label for="telefono">Teléfono</label>
    <input id="telefono" name="telefono"
           type="text"
           inputmode="numeric"
           maxlength="10"
           minlength="10"
           required>
    <span class="error" id="err_telefono"></span>
  </div>

  <!-- Contraseña -->
  <div class="field-group">
    <label for="password">Contraseña</label>
    <input id="password" name="password"
           type="password"
           minlength="6"
           required>
    <span class="error" id="err_password"></span>
  </div>

  <button type="submit" class="btn-primary" id="btn-registrar">
    Registrar
  </button>
</form>

<style>
  .field-group label{
    display:block;
    font-weight:600;
    margin-bottom:4px;
  }
  .field-group input{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #d1d5db;
    font-size:14px;
  }
  .field-group input:focus{
    outline:none;
    border-color:#2563eb;
    box-shadow:0 0 0 1px rgba(37,99,235,.3);
  }
  .error{
    display:block;
    font-size:12px;
    color:#dc2626;
    margin-top:2px;
    min-height:16px; /* espacio reservado para que no “salte” el layout */
  }
</style>

<script>
  (function () {
    const form      = document.getElementById('register-form');
    const btn       = document.getElementById('btn-registrar');

    const nombre    = document.getElementById('nombre');
    const apellido  = document.getElementById('apellido');
    const cedula    = document.getElementById('cedula');
    const email     = document.getElementById('email');
    const telefono  = document.getElementById('telefono');
    const password  = document.getElementById('password');

    const errNombre   = document.getElementById('err_nombre');
    const errApellido = document.getElementById('err_apellido');
    const errCedula   = document.getElementById('err_cedula');
    const errEmail    = document.getElementById('err_email');
    const errTelefono = document.getElementById('err_telefono');
    const errPassword = document.getElementById('err_password');

    // Email con TLD mínimo de 2 letras (ej: .com, .ec, .org)
    const EMAIL_RE = /^[^\s@]+@[^\s@]+\.[A-Za-z]{2,}$/;

    function validarNombre() {
      if (!nombre.value.trim()) {
        errNombre.textContent = 'Ingresa tu nombre';
        return false;
      }
      errNombre.textContent = '';
      return true;
    }

    function validarApellido() {
      if (!apellido.value.trim()) {
        errApellido.textContent = 'Ingresa tu apellido';
        return false;
      }
      errApellido.textContent = '';
      return true;
    }

    function validarCedula() {
      const v = cedula.value.trim();
      if (!/^\d{10}$/.test(v)) {
        errCedula.textContent = 'La cédula debe tener 10 números';
        return false;
      }
      errCedula.textContent = '';
      return true;
    }

    function validarEmail() {
      const v = email.value.trim();
      if (!EMAIL_RE.test(v)) {
        errEmail.textContent = 'Ingresa un email válido (ej: nombre@dominio.com)';
        return false;
      }
      errEmail.textContent = '';
      return true;
    }

    function validarTelefono() {
      const v = telefono.value.trim();
      if (!/^\d{10}$/.test(v)) {
        errTelefono.textContent = 'El teléfono debe tener 10 números';
        return false;
      }
      errTelefono.textContent = '';
      return true;
    }

    function validarPassword() {
      const v = password.value;
      if (v.length < 6) {
        errPassword.textContent = 'La contraseña debe tener al menos 6 caracteres';
        return false;
      }
      errPassword.textContent = '';
      return true;
    }

    // Validación en tiempo real
    nombre.addEventListener('input',   validarNombre);
    apellido.addEventListener('input', validarApellido);
    cedula.addEventListener('input',   validarCedula);
    email.addEventListener('input',    validarEmail);
    telefono.addEventListener('input', validarTelefono);
    password.addEventListener('input', validarPassword);

    form.addEventListener('submit', (e) => {
      const ok =
        validarNombre() &&
        validarApellido() &&
        validarCedula() &&
        validarEmail() &&
        validarTelefono() &&
        validarPassword();

      if (!ok) {
        e.preventDefault();
        return;
      }

      // Evita doble click solo en este botón
      btn.disabled = true;
      btn.textContent = 'Enviando…';
    });
  })();
</script>
