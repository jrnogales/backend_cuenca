<% layout('partials/layout') %>

<div class="auth-page">
  <div class="auth-card" style="max-width:640px;">
    <h2>Crear cuenta</h2>
    <p class="sub">Completa tus datos para registrarte.</p>

    <% if (typeof error === 'string' && error) { %>
      <div class="alert"><%= error %></div>
    <% } %>

    <form method="POST" action="/register" id="f-register" novalidate>
      <label>Nombre</label>
      <input type="text" name="nombre" required value="<%= nombre || '' %>">

      <label>Apellido</label>
      <input type="text" name="apellido" required value="<%= apellido || '' %>">

      <label>Cédula</label>
      <input
        id="ci"
        type="text"
        name="cedula"
        required
        inputmode="numeric"
        autocomplete="off"
        minlength="10"
        maxlength="10"
        pattern="[0-9]{10}"
        placeholder="10 dígitos"
        value="<%= cedula || '' %>"
      >
      <small class="muted" id="ci-help">Debe tener 10 dígitos numéricos.</small>

      <label>Email</label>
      <input type="email" name="email" required value="<%= email || '' %>">

      <label>Teléfono</label>
      <input type="tel" name="telefono" inputmode="tel" value="<%= telefono || '' %>">

      <label>Contraseña</label>
      <input type="password" name="password" required minlength="6">

      <button type="submit" class="btn-primary" style="width:100%;margin-top:12px;">Registrar</button>
    </form>

    <div class="auth-links">
      ¿Ya tienes cuenta? <a href="/login">Inicia sesión</a>
    </div>
  </div>
</div>

<script>
// ===== Validación RELAJADA: sólo 10 dígitos =====

// Mantén solo números y limita a 10
const ciInput = document.getElementById('ci');
const ciHelp  = document.getElementById('ci-help');

ciInput?.addEventListener('input', () => {
  // eliminar cualquier caracter no numérico
  ciInput.value = (ciInput.value || '').replace(/\D+/g, '').slice(0, 10);

  // feedback simple (sin bloquear)
  if (/^\d{10}$/.test(ciInput.value)) {
    ciInput.classList.remove('is-invalid');
    ciInput.classList.add('is-valid');
    if (ciHelp) ciHelp.textContent = 'Formato correcto: 10 dígitos.';
  } else {
    ciInput.classList.remove('is-valid');
    ciInput.classList.add('is-invalid');
    if (ciHelp) ciHelp.textContent = 'Debe tener exactamente 10 dígitos numéricos.';
  }
});

// Enviar sólo si hay 10 dígitos
document.getElementById('f-register')?.addEventListener('submit', (e) => {
  const raw = (ciInput?.value || '').trim();
  if (!/^\d{10}$/.test(raw)) {
    e.preventDefault();
    alert('Ingresa una cédula con exactamente 10 dígitos numéricos.');
    ciInput?.focus();
  }
});


</script>
